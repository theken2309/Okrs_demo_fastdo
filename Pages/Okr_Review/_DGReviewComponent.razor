        @*con của DGReview*@
        @*Trang okr chưa có đánh giá hoặc đang là okr đánh giá nháp *@
<section id="content" class="column has_sidebar ">
    <!--!--><!--!--><!--!--><!--!-->

    <section class="main_content" b-82z1cy6rii="">
        <div class="card" b-82z1cy6rii="">
            <ul class="columns is-vcentered is-variable is-2 mb-2" b-82z1cy6rii="">
                <!--!-->
                <li class="column is-narrow" b-82z1cy6rii="">
                    <a href="/okr/review" class="icon-text" b-82z1cy6rii="">
                        <span class="icon" b-82z1cy6rii="">
                            <span class="material-icons-outlined" b-82z1cy6rii="">
                                keyboard_backspace
                            </span>
                        </span>
                        <span b-82z1cy6rii="">
                            Trở về
                        </span>
                    </a>
                </li>
                <li class="column is-full-mobile" b-82z1cy6rii="">
                    <div class="user_item" b-82z1cy6rii="">
                        <img class="image is-36x36 mr-2" src="https://storage.googleapis.com/fastdo-storage.appspot.com/avatar/638397902369608569_bb896db4d8fd04a35dec.jpg" alt="IMG" b-82z1cy6rii=""><!--!-->
                        <div b-82z1cy6rii="">
                            <p class="has-text-weight-semibold has-text-info is-size-6" b-82z1cy6rii=""> @use.nameUse </p><!--!-->
                            <p class="text_1_line has-text-grey is-size-7" style="max-width: 200px;" b-82z1cy6rii="">FASTDO ĐÀ NẴNG / PHÒNG SẢN XUẤT</p>
                        </div>
                    </div>
                </li><!--!-->
                <li class="column is-one-third" b-82z1cy6rii="">
                    <div class="field has-addons" b-82z1cy6rii="">
                        <!--!--><div class="control" b-82z1cy6rii="">
                            <span class="button is-static" b-82z1cy6rii="">
                                OKRs
                            </span>
                        </div>
                        <div class="control is-expanded" b-82z1cy6rii=""><div class="select is-fullwidth" b-82z1cy6rii=""><select b-82z1cy6rii=""><option value="241B885119" b-82z1cy6rii="">Đạt Doanh Thu và Lợi Nhuận Tăng Trưởng</option><option value="241G1DE933" b-82z1cy6rii="">sâdadasd</option><option value="241J38B6EA" b-82z1cy6rii="">ádasda</option><option value="241PFEBADD" selected="" b-82z1cy6rii="">aaaaaaaaaaaaaaaa</option></select></div></div>
                    </div>
                </li>
                <li class="column is-narrow" b-82z1cy6rii=""><div class="buttons" b-82z1cy6rii=""></div></li>
            </ul>
            <div class="" b-82z1cy6rii="">
                <table class="table is-fullwidth is-vcentered is-noborder is-responsive" b-82z1cy6rii="">
                    <!--!-->
                    <thead b-82z1cy6rii="">
                        <tr class="is-size-7" style="border-bottom: 1px solid #DEDEDE;" b-82z1cy6rii="">
                            <th class="pt-0" b-82z1cy6rii="">Mục tiêu</th>
                            <th class="pt-0" width="150px" align="center" b-82z1cy6rii="">Tiến độ</th>
                            <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Điểm hệ thống</th>
                            <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Tự đánh giá</th>
                            <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">QL đánh giá</th>
                        </tr>
                    </thead>
                    <tbody b-82z1cy6rii="">
                        <tr b-82z1cy6rii="">
                            <td b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @okr_ne.name </span></td><!--!-->
                            <td b-82z1cy6rii="">
                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                <div class="td-value" b-82z1cy6rii="">
                                    <div class="progress_has_value" b-82z1cy6rii="">
                                        <progress class="progress is-small is-success" value=" @siuu(CalPercentKey(),CalPercentTagertKey())" max="100" b-82z1cy6rii=""></progress><!--!-->
                                        <span b-82z1cy6rii="">
                                            @if (okr_checkin.id != null)
                                            {
                                                @siuu(CalPercent(),CalPercentTagert())

                                            }
                                            else
                                                @siuu(CalPercentKey(),CalPercentTagertKey())

                                                    %
                                                </span>
                                            </div>
                                        </div>
                                    </td><!--!-->
                                    <td align="center" b-82z1cy6rii="">
                                        <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                        <div class="td-value" b-82z1cy6rii="">
                                            <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                            @if (okr_checkin.id != null)
                                        {
                                            @siuu(CalPercent(),CalPercentTagert())

                                        }
                                        else
                                            @siuu(CalPercentKey(),CalPercentTagert())

                                                <!--!-->%
                                            </div>
                                        </div>
                                    </td><!--!-->
                                    <td align="center" b-82z1cy6rii="">
                                        <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                        <div class="td-value" b-82z1cy6rii="">
                                            <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                            @if (okr_checkin.id != null)
                                        {
                                            @CalYou()

                                        }
                                        else
                                            @CalYouKey()

                                                %
                                            </div>
                                        </div>
                                    </td><!--!-->
                                    <td align="center" b-82z1cy6rii="">
                                        <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                        <div class="td-value" b-82z1cy6rii="">
                                            <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                            @if (okr_checkin.id != null)
                                        {
                                            @CalMan()
                                        }
                                        else
                                            @CalManKey()

                                                <!--!-->%
                                            </div>
                                        </div>
                                    </td>
                                </tr><!--!-->
                            <tr b-82z1cy6rii="">
                                <td colspan="5" class="td-block" b-82z1cy6rii="">
                                    <div class="field" b-82z1cy6rii="">
                                        <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét OKRs</label>
                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!-->@okr_rv.staff_comment</div></div>
                                    </div>
                                </td>
                            </tr>
                            @if (okr_rv.manager_comment != null)
                        {
                            <tr b-82z1cy6rii="">
                                <td colspan="5" class="td-block" b-82z1cy6rii="">
                                    <div class="field" b-82z1cy6rii="">
                                        <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét OKRs</label>
                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @okr_rv.manager_comment </div></div>
                                    </div>
                                </td>
                            </tr>

                            <!--!-->
                        }
                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                        <!--!-->
                        <tr class="has-text-grey is-hidden-mobile" b-82z1cy6rii="">
                            <td class="pl-6" b-82z1cy6rii="">Kết quả then chốt</td>
                            <td align="center" b-82z1cy6rii="">Đạt được</td>
                            <td align="center" b-82z1cy6rii="">Điểm hệ thống</td>
                            <td align="center" b-82z1cy6rii="">Tự đánh giá</td>
                            <td align="center" b-82z1cy6rii="">QL đánh giá</td>
                        </tr>
                        @if (okr_checkin == null)
                        {
                            @foreach (var Key in okr_ne.key_results)
                            {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @Key.review_data.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @Key.review_data.manager_point <!--!-->%
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.review_data.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                if (Key.review_data.manager_comment != null)
                                {
                                            <tr b-82z1cy6rii="">
                                                <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                    <div class="field" b-82z1cy6rii="">
                                                        <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.review_data.manager_comment</div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                }
                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                            }
                        }
                        else
                        {
                            @foreach (var Key in okr_checkin.key_results)
                            {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @Key.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                @Key.manager_point <!--!-->%
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                @if (Key.manager_comment != null)
                                {
                                            <tr b-82z1cy6rii="">
                                                <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                    <div class="field" b-82z1cy6rii="">
                                                        <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.manager_comment</div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                }
                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                            }
                        }
                        <tr b-82z1cy6rii="">
                            <td colspan="5" class="td-block" b-82z1cy6rii="">
                                <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Nhân sự phản hồi</span>
                                <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                    <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                    <div class="dropdown-menu" b-82z1cy6rii="">
                                        <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                            <div class="dropdown-item content" b-82z1cy6rii="">
                                                <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                <p b-82z1cy6rii="">Bạn nhận được gì từ người quản lý của bạn mà bạn thấy hữu ích hoặc giúp đỡ bạn tốt?</p>
                                                <p b-82z1cy6rii="">Điều gì từ người quản lý đã gây ảnh hưởng tới hoạt động OKRs này của bạn?</p>
                                                <p b-82z1cy6rii="">Nếu quay lại thời gian, người quản lý nên làm gì để giúp bạn thành công trong OKRs này hơn?</p>
                                                <p b-82z1cy6rii="">Các kỹ năng, năng lực tôi muốn cải thiện và tốt hơn trong tương lai?</p>
                                                <p b-82z1cy6rii="">Điều gì từ công ty mà bạn kỳ vọng sẽ giúp ích cho việc cải thiện năng lực của bạn?</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="control mt-2" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @okr_rv.review_staff_comment </div></div>
                            </td>
                        </tr>
                        @if (@okr_rv.review_manager_comment != null)
                        {
                            <tr b-82z1cy6rii="">
                                <td colspan="5" class="td-block" b-82z1cy6rii="">
                                    <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Quản lý phản hồi</span>
                                    <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                        <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                        <div class="dropdown-menu" b-82z1cy6rii="">
                                            <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                                <div class="dropdown-item content" b-82z1cy6rii="">
                                                    <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                    <p b-82z1cy6rii="">OKRs này, Nhân sự làm việc như thế nào, hiệu quả chưa?</p>
                                                    <p b-82z1cy6rii="">Nhân sự cần làm gì để quý cải thiện và tốt hơn?</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                        <div class="control mt-2" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!-->@okr_rv.review_manager_comment</div></div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </section>
</section>
@code {
    [Parameter]
    public okrModel okr_ne { get; set; }
    [Parameter]
    public OkrCheckInModel okr_checkin { get; set; }
    [Parameter]
    public Okr_reviewModel okr_rv { get; set; }
    UseModel use = new();
    protected override async Task OnInitializedAsync()
    {
        use.id = okr_ne.user_create;
        use = await DbUse.Get(use);

    }
    // các phương thức tính
    private double siuu(double a, double b)
    {
        if (a == 0 || b == 0)
            return 0;
        double result = a / b * 100;
        if (result > 100) result = 100;
        return Math.Round(result, 2);
    }
    private double CalPercent()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.result;
            result += k;
        }
        return result;
    }
    private double CalPercentKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.result;
            result += k;
        }
        return result;
    }
    private double CalPercentTagert()
    {
        double target = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.target;
            target += k;
        }
        return target;

    }
    private double CalPercentTagertKey()
    {
        double target = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.target;
            target += k;
        }
        return target;
    }
    private double CalYou()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.staff_point;
            result += k;
        }
        result = result / okr_checkin.key_results.Count();
        if (result > 100) result = 100;
        return result;

    }
    private double CalYouKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.review_data.staff_point;
            result += k;
        }
        result = result / okr_ne.key_results.Count();
        if (result > 100) result = 100;
        return result;
    }
    private double CalMan()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.manager_point;
            result += k;
        }
        result = result / okr_checkin.key_results.Count();
        if (result > 100) result = 100;
        return result;

    }
    private double CalManKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.review_data.manager_point;
            result += k;
        }
        result = result / okr_ne.key_results.Count();
        if (result > 100) result = 100;
        return result;
    }
}
