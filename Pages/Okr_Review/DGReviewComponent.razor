@inject IJSRuntime JSRuntime
@inject NavigationManager navigation
  @*Trang mà người khác vào đánh giá *@
  @*Component con của _OkrReview*@


@*đánh giá khi okr_rv đã gửi hoặc đã đánh giá xong*@
@if (okr_rv.review_send_status == 2 || okr_rv.review_send_status == 3)
{
    <section id="content" class="column has_sidebar ">
        <!--!--><!--!--><!--!--><!--!-->
        <section class="main_content" b-82z1cy6rii="">
            <div class="card" b-82z1cy6rii="">
                <ul class="columns is-vcentered is-variable is-2 mb-2" b-82z1cy6rii="">
                    <!--!-->
                    <li class="column is-narrow" b-82z1cy6rii="">
                        <a href="/okr/review" class="icon-text" b-82z1cy6rii="">
                            <span class="icon" b-82z1cy6rii="">
                                <span class="material-icons-outlined" b-82z1cy6rii="">
                                    keyboard_backspace
                                </span>
                            </span>
                            <span b-82z1cy6rii="">
                                Trở về
                            </span>
                        </a>
                    </li>
                    <li class="column is-full-mobile" b-82z1cy6rii="">
                        <div class="user_item" b-82z1cy6rii="">
                            <img class="image is-36x36 mr-2" src="https://storage.googleapis.com/fastdo-storage.appspot.com/avatar/638397892712111783_305765668_3349443641956452_8173267747623672115_n.jpg" alt="IMG" b-82z1cy6rii=""><!--!-->
                            <div b-82z1cy6rii="">
                                <p class="has-text-weight-semibold has-text-info is-size-6" b-82z1cy6rii=""> @use.nameUse </p><!--!-->
                                <p class="text_1_line has-text-grey is-size-7" style="max-width: 200px;" b-82z1cy6rii="">FASTDO ĐÀ NẴNG / PHÒNG SẢN XUẤT</p>
                            </div>
                        </div>
                    </li><!--!-->
                    <li class="column is-one-third" b-82z1cy6rii="">
                        <div class="field has-addons" b-82z1cy6rii="">
                            <!--!--><div class="control" b-82z1cy6rii="">
                                <span class="button is-static" b-82z1cy6rii="">
                                    OKRs
                                </span>
                            </div>
                        </div>
                    </li>
                    @if (okr_rv.review_send_status == 2)
                    {
                        @if (rv == false)
                        {
                            <li class="column is-narrow" b-82z1cy6rii="">
                                <div class="buttons" b-82z1cy6rii="">
                                    <a class="button is-link" b-82z1cy6rii="" @onclick="Ree">
                                        <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">fact_check</i></span>
                                        <!--!--><span b-82z1cy6rii="">Đánh giá</span>
                                    </a><!--!-->
                                    <a class="button is-info" b-82z1cy6rii="" @onclick = "DGAgain">
                                        <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">refresh</i></span>
                                        <!--!--><span b-82z1cy6rii="" >Đánh giá lại</span>
                                    </a>
                                </div>
                            </li>
                        }
                        else
                        {
                            <li class="column is-narrow" b-82z1cy6rii="">
                                <div class="buttons" b-82z1cy6rii="" @onclick="Ree">
                                    <a class="button is-danger" b-82z1cy6rii="">
                                        <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">cancel</i></span>
                                        <!--!--><span b-82z1cy6rii="">Hủy</span>
                                    </a>
                                </div>
                            </li>
                        }
                    }
                    else
                    {
                        <li class="column is-narrow" b-82z1cy6rii="">
                            <div class="buttons" b-82z1cy6rii="">
                                <a class="button is-info" b-82z1cy6rii="" @onclick = "DGAgain">
                                    <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">refresh</i></span>
                                    <!--!--><span b-82z1cy6rii="">Đánh giá lại</span>
                                </a><!--!-->
                                <!--!--><span class="icon-text has-text-link" b-82z1cy6rii="">
                                    <span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">done</i></span>
                                    <span b-82z1cy6rii="">Đã đánh giá</span>
                                </span>
                            </div>
                        </li>
                    }
                </ul>
                @*chưa click danh gia *@
                @if (rv == false)
                {
                    <div class="" b-82z1cy6rii="">
                        <table class="table is-fullwidth is-vcentered is-noborder is-responsive" b-82z1cy6rii="">
                            <!--!-->
                            <thead b-82z1cy6rii="">
                                <tr class="is-size-7" style="border-bottom: 1px solid #DEDEDE;" b-82z1cy6rii="">
                                    <th class="pt-0" b-82z1cy6rii="">Mục tiêu</th>
                                    <th class="pt-0" width="150px" align="center" b-82z1cy6rii="">Tiến độ</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Điểm hệ thống</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Tự đánh giá</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">QL đánh giá</th>
                                </tr>
                            </thead>
                            <tbody b-82z1cy6rii="">
                                <tr b-82z1cy6rii="">
                                    <td b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @okr_ne.name </span></td><!--!-->
                                    <td b-82z1cy6rii="">
                                        <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                        <div class="td-value" b-82z1cy6rii="">
                                            <div class="progress_has_value" b-82z1cy6rii="">
                                                <progress class="progress is-small is-success" value=" @siuu(CalPercent(),CalPercentTagert())" max="100" b-82z1cy6rii=""></progress><!--!-->
                                                <span b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                    {
                                                        @siuu(CalPercent(),CalPercentTagert())

                                                    }
                                                    else
                                                        @siuu(CalPercentKey(),CalPercentTagertKey())
                                                        %
                                                    </span>
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                {
                                                    @siuu(CalPercent(),CalPercentTagert())

                                                }
                                                else
                                                    @siuu(CalPercentKey(),CalPercentTagert())



                                                    <!--!-->%
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                {
                                                    @CalYou()

                                                }
                                                else
                                                    @CalYouKey()

                                                    %
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                           @if (okr_checkin.id != null)
                                                {
                                                    @CalMan()

                                                }
                                                else
                                                    @CalManKey()

                                                    <!--!-->%
                                                </div>
                                            </div>
                                        </td>
                                    </tr><!--!-->
                                    <tr b-82z1cy6rii="">
                                        <td colspan="5" class="td-block" b-82z1cy6rii="">
                                            <div class="field" b-82z1cy6rii="">
                                                <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét OKRs</label>
                                                <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!-->@okr_rv.staff_comment</div></div>
                                            </div>
                                        </td>
                                    </tr>
                                    @if (okr_rv.manager_comment != null)
                                {
                                    <tr b-82z1cy6rii="">
                                        <td colspan="5" class="td-block" b-82z1cy6rii="">
                                            <div class="field" b-82z1cy6rii="">
                                                <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét OKRs</label>
                                                <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @okr_rv.manager_comment </div></div>
                                            </div>
                                        </td>
                                    </tr>
                                    <!--!-->
                                }
                                <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                <!--!-->
                                <tr class="has-text-grey is-hidden-mobile" b-82z1cy6rii="">
                                    <td class="pl-6" b-82z1cy6rii="">Kết quả then chốt</td>
                                    <td align="center" b-82z1cy6rii="">Đạt được</td>
                                    <td align="center" b-82z1cy6rii="">Điểm hệ thống</td>
                                    <td align="center" b-82z1cy6rii="">Tự đánh giá</td>
                                    <td align="center" b-82z1cy6rii="">QL đánh giá</td>
                                </tr>
                                @*Nếu okr chưa checkin thì hiện của okr *@
                                @if (okr_checkin.id == null)
                                {
                                    @foreach (var Key in okr_ne.key_results)
                                    {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.review_data.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.review_data.manager_point <!--!-->%
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.review_data.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                        @if (Key.review_data.manager_comment != null)
                                        {
                                            <tr b-82z1cy6rii="">
                                                <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                    <div class="field" b-82z1cy6rii="">
                                                        <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.review_data.manager_comment</div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                    }
                                }
                                @*neu okr da checkin roi *@
                                else
                                {
                                    @foreach (var Key in okr_checkin.key_results)
                                    {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.manager_point <!--!-->%
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>

                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                        @if (Key.manager_comment != null)
                                        {
                                            <tr b-82z1cy6rii="">
                                                <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                    <div class="field" b-82z1cy6rii="">
                                                        <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                        <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.manager_comment</div></div>
                                                    </div>
                                                </td>
                                            </tr>
                                        }
                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                    }
                                }
                                <tr b-82z1cy6rii="">
                                    <td colspan="5" class="td-block" b-82z1cy6rii="">
                                        <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Nhân sự phản hồi</span>
                                        <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                            <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                            <div class="dropdown-menu" b-82z1cy6rii="">
                                                <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                                    <div class="dropdown-item content" b-82z1cy6rii="">
                                                        <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                        <p b-82z1cy6rii="">Bạn nhận được gì từ người quản lý của bạn mà bạn thấy hữu ích hoặc giúp đỡ bạn tốt?</p>
                                                        <p b-82z1cy6rii="">Điều gì từ người quản lý đã gây ảnh hưởng tới hoạt động OKRs này của bạn?</p>
                                                        <p b-82z1cy6rii="">Nếu quay lại thời gian, người quản lý nên làm gì để giúp bạn thành công trong OKRs này hơn?</p>
                                                        <p b-82z1cy6rii="">Các kỹ năng, năng lực tôi muốn cải thiện và tốt hơn trong tương lai?</p>
                                                        <p b-82z1cy6rii="">Điều gì từ công ty mà bạn kỳ vọng sẽ giúp ích cho việc cải thiện năng lực của bạn?</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="control mt-2" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @okr_rv.review_staff_comment </div></div>
                                    </td>
                                </tr>
                                @if (@okr_rv.review_manager_comment != null)
                                {
                                    <tr b-82z1cy6rii="">
                                        <td colspan="5" class="td-block" b-82z1cy6rii="">
                                            <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Quản lý phản hồi</span>
                                            <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                                <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                                <div class="dropdown-menu" b-82z1cy6rii="">
                                                    <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                                        <div class="dropdown-item content" b-82z1cy6rii="">
                                                            <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                            <p b-82z1cy6rii="">OKRs này, Nhân sự làm việc như thế nào, hiệu quả chưa?</p>
                                                            <p b-82z1cy6rii="">Nhân sự cần làm gì để quý cải thiện và tốt hơn?</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="control mt-2" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!-->@okr_rv.review_manager_comment</div></div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="" b-82z1cy6rii="">
                        <table class="table is-fullwidth is-vcentered is-noborder is-responsive" b-82z1cy6rii="">
                            <!--!-->
                            <thead b-82z1cy6rii="">
                                <tr class="is-size-7" style="border-bottom: 1px solid #DEDEDE;" b-82z1cy6rii="">
                                    <th class="pt-0" b-82z1cy6rii="">Mục tiêu</th>
                                    <th class="pt-0" width="150px" align="center" b-82z1cy6rii="">Tiến độ</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Điểm hệ thống</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">Tự đánh giá</th>
                                    <th class="pt-0" width="120px" align="center" b-82z1cy6rii="">QL đánh giá</th>
                                </tr>
                            </thead>
                            <tbody b-82z1cy6rii="">
                                <tr b-82z1cy6rii="">
                                    <td b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @okr_ne.name </span></td><!--!-->
                                    <td b-82z1cy6rii="">
                                        <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                        <div class="td-value" b-82z1cy6rii="">
                                            <div class="progress_has_value" b-82z1cy6rii="">
                                                <progress class="progress is-small is-success" value="91" max="100" b-82z1cy6rii=""></progress><!--!-->
                                                <span b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                    {
                                                        @siuu(CalPercent(),CalPercentTagert())
                                                    }
                                                    else
                                                        @siuu(CalPercentKey(),CalPercentTagertKey())
                                                    </span>
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                {
                                                    @siuu(CalPercent(),CalPercentTagert())

                                                }
                                                else
                                                    @siuu(CalPercentKey(),CalPercentTagert())
                                                    <!--!-->%
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                {
                                                    @CalYou()

                                                }
                                                else
                                                    @CalYouKey()
                                                    %
                                                </div>
                                            </div>
                                        </td><!--!-->
                                        <td align="center" b-82z1cy6rii="">
                                            <!--!--><label class="td-label" b-82z1cy6rii="">QL đánh giá</label>
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                    @if (okr_checkin.id != null)
                                                {
                                                    @CalMan()
                                                }
                                                else
                                                    @CalManKey()
                                                    <!--!-->%
                                                </div>
                                            </div>
                                        </td>
                                    </tr><!--!-->
                                <tr b-82z1cy6rii="">
                                    <td colspan="5" class="td-block" b-82z1cy6rii="">
                                        <div class="field" b-82z1cy6rii="">
                                            <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét OKRs</label>
                                            <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!-->@okr_rv.staff_comment</div></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr b-82z1cy6rii="">
                                    <td colspan="5" class="td-block" b-82z1cy6rii="">
                                        <div class="field" b-82z1cy6rii="">
                                            <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét OKRs</label>
                                            <div class="control" b-82z1cy6rii=""><textarea @bind="okr_rv.manager_comment" class="textarea is_bg" rows="2" placeholder="Nhập nhận xét của bạn" b-82z1cy6rii=""></textarea></div>
                                        </div>
                                    </td>
                                </tr>
                                <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                <!--!-->
                                <tr class="has-text-grey is-hidden-mobile" b-82z1cy6rii="">
                                    <td class="pl-6" b-82z1cy6rii="">Kết quả then chốt</td>
                                    <td align="center" b-82z1cy6rii="">Đạt được</td>
                                    <td align="center" b-82z1cy6rii="">Điểm hệ thống</td>
                                    <td align="center" b-82z1cy6rii="">Tự đánh giá</td>
                                    <td align="center" b-82z1cy6rii="">QL đánh giá</td>
                                </tr>
                                @if (okr_checkin.id == null)
                                {
                                    @foreach (var Key in okr_ne.key_results)
                                    {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.review_data.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="control has-icons-right" b-82z1cy6rii="">
                                                    <input @bind="Key.review_data.manager_point" placeholder="Nhập số điểm" class="input has-text-centered has-text-weight-semibold is_bg" b-82z1cy6rii=""><!--!-->
                                                    <!--!--><span class="icon is-right has-text-dark" b-82z1cy6rii="">%</span>
                                                </div>
                                            </div>
                                        </tr>

                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.review_data.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><textarea @bind="Key.review_data.manager_comment" class="textarea is_bg" rows="2" placeholder="Nhập nhận xét của bạn" b-82z1cy6rii=""></textarea></div>
                                                </div>
                                            </td>
                                        </tr>

                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                        @if (string.IsNullOrEmpty(Key.review_data.manager_comment)) checkKR = false; else checkKR = true;
                                    }
                                }
                                else
                                {
                                    @foreach (var Key in okr_checkin.key_results)
                                    {
                                        <tr b-82z1cy6rii="">
                                            <td class="pl-6" b-82z1cy6rii=""><span class="has-text-weight-semibold has-text-link" b-82z1cy6rii=""> @Key.name </span></td><!--!-->
                                            <td b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tiến độ</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <span class="has-text-success" b-82z1cy6rii="">@Key.result/@Key.target</span><!--!-->
                                                    <span class="is-pulled-right" b-82z1cy6rii="">  @Key.unit </span>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Điểm hệ thống</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @siuu(@Key.result,Key.target)<!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <td align="center" b-82z1cy6rii="">
                                                <!--!--><label class="td-label" b-82z1cy6rii="">Tự đánh giá</label>
                                                <div class="td-value" b-82z1cy6rii="">
                                                    <div class="input is-centered has-text-weight-semibold is_bg" b-82z1cy6rii="">
                                                        @Key.staff_point  <!--!-->%
                                                    </div>
                                                </div>
                                            </td><!--!-->
                                            <div class="td-value" b-82z1cy6rii="">
                                                <div class="control has-icons-right" b-82z1cy6rii="">
                                                    <input @bind="Key.manager_point" placeholder="Nhập số điểm" class="input has-text-centered has-text-weight-semibold is_bg" b-82z1cy6rii=""><!--!-->
                                                    <!--!--><span class="icon is-right has-text-dark" b-82z1cy6rii="">%</span>
                                                </div>
                                            </div>
                                        </tr>

                                        <!--!-->
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Nhân sự nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @Key.staff_comment </div></div>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr b-82z1cy6rii="">
                                            <td colspan="5" class="pl-6 td-block" b-82z1cy6rii="">
                                                <div class="field" b-82z1cy6rii="">
                                                    <!--!--><label class="label" b-82z1cy6rii="">Quản lý nhận xét KRs</label>
                                                    <div class="control" b-82z1cy6rii=""><textarea @bind="Key.manager_comment" class="textarea is_bg" rows="2" placeholder="Nhập nhận xét của bạn" b-82z1cy6rii=""></textarea></div>
                                                </div>
                                            </td>
                                        </tr>

                                        <!--!-->
                                        <tr class="is-hidden-mobile" b-82z1cy6rii=""><td colspan="5" b-82z1cy6rii=""><hr class="m-0" b-82z1cy6rii=""></td></tr>
                                        @if (string.IsNullOrEmpty(Key.manager_comment)) checkKR = false; else checkKR = true;

                                    }
                                }
                                <tr b-82z1cy6rii="">
                                    <td colspan="5" class="td-block" b-82z1cy6rii="">
                                        <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Nhân sự phản hồi</span>
                                        <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                            <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                            <div class="dropdown-menu" b-82z1cy6rii="">
                                                <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                                    <div class="dropdown-item content" b-82z1cy6rii="">
                                                        <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                        <p b-82z1cy6rii="">Bạn nhận được gì từ người quản lý của bạn mà bạn thấy hữu ích hoặc giúp đỡ bạn tốt?</p>
                                                        <p b-82z1cy6rii="">Điều gì từ người quản lý đã gây ảnh hưởng tới hoạt động OKRs này của bạn?</p>
                                                        <p b-82z1cy6rii="">Nếu quay lại thời gian, người quản lý nên làm gì để giúp bạn thành công trong OKRs này hơn?</p>
                                                        <p b-82z1cy6rii="">Các kỹ năng, năng lực tôi muốn cải thiện và tốt hơn trong tương lai?</p>
                                                        <p b-82z1cy6rii="">Điều gì từ công ty mà bạn kỳ vọng sẽ giúp ích cho việc cải thiện năng lực của bạn?</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="control mt-2" b-82z1cy6rii=""><div class="has_bg is_radius p-3 is-word-break" b-82z1cy6rii=""><!--!--> @okr_rv.review_staff_comment </div></div>
                                    </td>
                                </tr>
                                <tr b-82z1cy6rii="">
                                    <td colspan="5" class="td-block" b-82z1cy6rii="">
                                        <!--!--><span class="has-text-weight-semibold is-size-6 has-text-info mr-2" b-82z1cy6rii="">Quản lý phản hồi</span>
                                        <!--!--><div class="dropdown is-up is-hoverable" b-82z1cy6rii="">
                                            <div class="dropdown-trigger" b-82z1cy6rii=""><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-5" b-82z1cy6rii="">infor</i></span></div>
                                            <div class="dropdown-menu" b-82z1cy6rii="">
                                                <div class="dropdown-content" style="min-width:400px;width:fit-content" b-82z1cy6rii="">
                                                    <div class="dropdown-item content" b-82z1cy6rii="">
                                                        <p class="has-text-weight-semibold" b-82z1cy6rii="">Gợi ý câu hỏi</p>
                                                        <p b-82z1cy6rii="">OKRs này, Nhân sự làm việc như thế nào, hiệu quả chưa?</p>
                                                        <p b-82z1cy6rii="">Nhân sự cần làm gì để quý cải thiện và tốt hơn?</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="control mt-2" b-82z1cy6rii=""><textarea @bind="okr_rv.review_manager_comment" class="textarea is_bg" rows="2" placeholder="Nhập phản hồi của bạn" b-82z1cy6rii=""></textarea></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <ul class="columns is-multiline is-variable is-2 is-mobile" b-82z1cy6rii="">
                            <!--!-->
                            <li class="column" b-82z1cy6rii=""></li>
                            <li class="column is-narrow" b-82z1cy6rii="">
                                <a class="button is-white has-text-danger" b-82z1cy6rii="" @onclick="Ree">
                                    <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">close</i></span>
                                    <!--!--><span b-82z1cy6rii="">Hủy</span>
                                </a>
                            </li><!--!-->
                            <li class="column is-narrow" b-82z1cy6rii="">
                                <a class="button is-link" b-82z1cy6rii="" @onclick="Done">
                                    <!--!--><span class="icon" b-82z1cy6rii=""><i class="material-icons-outlined is-size-6" b-82z1cy6rii="">done</i></span>
                                    <!--!--><span b-82z1cy6rii="">Hoàn tất</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                }
            </div>
        </section>
    </section>
}
@*khi okr_rv chưa được đánh giá *@
else if (okr_rv.review_send_status == 1 || okr_rv.id==null )
{
    <_DGReviewComponent okr_checkin="okr_checkin" okr_ne="okr_ne" okr_rv="okr_rv" />
}
@code {
    [CascadingParameter]
    public MainLayout layoutmain { get; set; }
    [Parameter]
    public okrModel okr_ne { get; set; }
    [Parameter]
    public OkrCheckInModel okr_checkin { get; set; }
    [Parameter]
    public Okr_reviewModel okr_rv { get; set; }
    bool rv,checkKR = false;
    // mở form đánh giá okr này
    public void Ree()
    {
        if(layoutmain.IdU == okr_ne.parent)
        {
            rv = !rv;
        }else
        {
            JSRuntime.InvokeVoidAsync("tagline", false, "Bạn Không có quyền Đánh giá Okr này");

        }
    }
    UseModel use = new();
    // đánh giá okr
    private void Done()
    {
        if (okr_rv.manager_comment == null || okr_rv.review_manager_comment == null || checkKR==false)
        {
            JSRuntime.InvokeVoidAsync("tagline", false, "Bạn phải điền nhận xét của bạn");

        }

        else
        {
            JSRuntime.InvokeVoidAsync("tagline", true, "Đánh giá thành công");

            okr_rv.okrID = okr_ne.id;
            okr_rv.review_send_status = 3;
            okr_ne.review_manager_date = DateTime.Now.Ticks;
            DbOkr.Update(okr_ne);
            DbOkrCheckin.Update(okr_checkin);
            DbOkrReview.Update(okr_rv);
            navigation.NavigateTo(navigation.Uri, true);
        }

    }
    // các phương thức tính
    private double CalPercent()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.result;
            result += k;
        }
        return result;
    }
    private double siuu(double a, double b)
    {
        if (a == 0 || b == 0)
            return 0;
        double result = a / b * 100;
        if (result > 100) result = 100;
        return Math.Round(result, 2);
    }
    private double CalPercentKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.result;
            result += k;
        }
        return result;
    }
    private double CalPercentTagert()
    {
        double target = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.target;
            target += k;
        }
        return target;

    }
    private double CalPercentTagertKey()
    {
        double target = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.target;
            target += k;
        }
        return target;
    }
    private double CalYou()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.staff_point;
            result += k;
        }
        result = result / okr_checkin.key_results.Count();
        if (result > 100) result = 100;
        return Math.Round(result, 2); ;

    }
    private double CalYouKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.review_data.staff_point;
            result += k;
        }
        result = result / okr_ne.key_results.Count();
        if (result > 100) result = 100;

        return Math.Round(result, 2); ;
    }
    private double CalMan()
    {
        double result = 0;

        foreach (var key in okr_checkin.key_results)
        {
            var k = key.manager_point;
            result += k;
        }
        result = result / okr_checkin.key_results.Count();
        if (result > 100) result = 100;
        return Math.Round(result, 2); ;

    }
    private double CalManKey()
    {
        double result = 0;

        foreach (var key in okr_ne.key_results)
        {
            var k = key.review_data.manager_point;
            result += k;
        }
        result = result / okr_ne.key_results.Count();
        if (result > 100) result = 100;
        return Math.Round(result, 2); ;
    }
    // đánh giá lại 
    private async void DGAgain()
    {
        if (layoutmain.IdU == okr_ne.parent)
        {
            if (!await JSRuntime.InvokeAsync<bool>("confirm", $"Bạn có chắc muốn OKR này đánh giá lại  ?"))
                return;
            okr_ne.parent = null;
            DbOkrReview.Delete(okr_ne.id);
            okr_checkin.review_manager_date = 0;
            okr_checkin.review_send_date = 0;
            @foreach(var okrci in okr_checkin.key_results)
            {
                okrci.staff_comment = null;
                okrci.staff_point = 0;
                okrci.manager_comment = null;
                okrci.manager_point = 0;

            }
            @foreach(var okr in okr_ne.key_results)
            {
                okr.review_data = new();
            }
            DbOkrCheckin.Update(okr_checkin);
            okr_ne.review_manager_date = 0;
            okr_ne.review_send_date = 0;
            DbOkr.Update(okr_ne);
            navigation.NavigateTo("okr/review");
        }
        else
        {
            JSRuntime.InvokeVoidAsync("tagline", false, "Bạn Không có quyền Đánh giá Okr này");
        }
    }
    protected override async Task OnInitializedAsync()
    {
        use.id = okr_ne.user_create;
        use = await DbUse.Get(use);

    }
}
